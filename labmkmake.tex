\labwork{Создание Makefile}\label{labmkmake}

Стоит объяснить, почему при создании проекта мы выбрали тип \file{Makefile
project}, хотя были доступны более логичные варианты типа \file{ARM C Project}.

Утилита \make\ ведет свою историю с 70х гг. Компьютеры тогда были большими,
тяжелыми, а главное медленными и с очень маленькой памятью (десятки$\div$сотни
Кб).
Компиляторам зачастую не хватало памяти, чтобы скомпилировать большую программу.
Кроме того, скорость их запуска и работы была тоже черепашьей.
Поэтому исходный код программы делили на модули, компилировали или
ассемблировали каждый модуль по-отдельности в \term{объектный код}, а затем уже
на конечном этапе с помощью \term{линкера}\ собирали несколько файлов объектного
кода в один исполнямый файл.

Для ускорения и упрощения этого процесса и была создана утилита \make.
Чтобы не вызывать лишний раз компилятор или какой-нибудь транслятор, в файле
\makefile\ прописываются зависимости между файлами. Затем запускается \make\ c
указанием какой файл нам нужно получить, и выполняется цепочка вызовов
нужных программ.

Следует отметить, что утилита \make\ используется до сих пор для сборки самых
современных программных пакетов (типа GCC 4.9.x), правда в комплексе с другими
средствами, обеспечивающими переносимость программ между разными ОС и
автогенерацией зависимостей из исходного кода.

\bigskip
Для наших целей \make\ используется как самое простое средство управления
компиляцией проекта. В средах разработки, особенно в коммерческих,
используются служебные файлы проектов, иногда бинарные, чаще текстовые, но
всегда запутанные и весьма развесистые.

Если вам вдруг понадобится откомпилировать ваш проект на другом компьютере,
с другой архитектурой, возможно вообще без графического
интерфейса\footnote{например какой-нибудь удаленный сервер на
процессоре 1995ВМ666 под раскряченным Solaris 7$\alpha$4, на котором лежит
криптобиблиотека, использующая при компиляции трофейный электро-механический 
энкодер, существующий в единственном экземпляре \smiley}, или вы вдруг решите
попробовать работать в другой IDE\ --- вы тут же вляпаетесь в ситуацию, 
когда нечем открыть файл проекта с заботливо прописанными опциями
компиляции.

\bigskip
\menu{\eclipse>\window{Project Explorer}>\file{hello}>\rms>Open Project}

\menu{\eclipse>\window{Project Explorer}>\file{hello}>\rms>New>File>File
name:>\file{Makefile}}

\bigskip
\lstinputlisting[style=mk,inputencoding=cp1251]{tmp/hello.mk}

\bigskip
Этот пример \makefile\ достаточно универсален и самодостаточен для большинства
проектов в этой книге. Кажущийся большой объем получился за счет использования
комментариев и переменных. И те, и другие служат для документирования проекта,
и повышают читаемость кода. В принципе никто не мешает\footnote{особенно для
микроскопических объемов исходных текстов программ для контроллеров\ ---
в самом худшем случае какие-то жалкие сотни Кб}\ написать несколько строк в
\file{.bat}нике с явным указанием опций компиляторам, или вообще откомпилировать
все исходники сразу одним вызовом \file{gcc}\ с кучей опций и списком исходных
файлов. Но если вам потребуется что-то изменить, куда проще и быстрее сделать
это в аккуратно оформленном самодокументированном \makefile.

