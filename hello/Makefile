# пример мэйкфайла для проекта Азбука ARMатурщика
# лабораторная работа ЛР{labmkmake}
# символ # в начале -- комментарий 

# пример использования переменных

# простое присваивание значения переменной
# целевая платформа $TARGET
TARGET = arm-none-aebi
# целевой процессор
CPU = cortex-m3

# присваивание переменной с подстановкой значений другой переменной
# стандартные переменные, задающие команды ассемблера, компилятора и линкера 
AS = $(TARGET)-as
СС = $(TARGET)-gcc
LD = $(TARGET)-ld
MAKE = make

# нестандартная (?) переменная - опции оптимизации
OPTFLAGS = -O0
# стандартная переменная - флаги компилятора Си
CFLAGS = -mcpu=$(CPU) $(OPTFLAGS)

# указание что цели all и clean являются фиктивными целями, а не файлами
.PHONY: all clean

# первая цель, заданная в Makefile, является целью по умолчанию
# и обрабатывается при вызове $(MAKE) без параметров

# стандартная цель, предусматривающая сборку всего проекта 
all:

# стандартная цель, удаление всех временных и конечных бинарных файлов
clean:

# макро-правило: скомпилировать все сишные файлы по маске в объектный код
# тэг $@ заменяется на цель правила, т.е. %.o
# тэг $< заменяется на первый источник, т.е. %.с
%.o: %.c Makefile
	$(CC) $(CFLAGS) -o $@ $<

# макро-правило: скомпилировать все ассемблерные файлы
%.o: %.S
	$(AS) -o $@ $<
	